{% extends "base.html" %}
{% block content %}
<div class="p-6 pb-24 mx-auto max-w-screen-xl">

    <div class="flex justify-between items-center mb-6 bg-dark p-2 rounded-xl">
        <a href="{{ url_for('log.log_entry', selected_date=prev_week_start.strftime('%Y-%m-%d')) }}" class="p-2 rounded-full hover:bg-gray-700">&lt;</a>
        <div class="flex-1 flex justify-between items-center overflow-x-auto mx-2 md:mx-0 md:justify-center">
            {% for day in weekly_dates %}
            {% set is_today = day == date.today() %}
            {% set display_date = 'Today' if is_today else day.strftime('%B %-d') %}
            <a href="{{ url_for('log.log_entry', selected_date=day.strftime('%Y-%m-%d')) }}" class="flex-1 text-center p-2 mx-1 rounded-full {{ 'bg-teal' if day == selected_date else 'hover:bg-gray-700' }}">
                <span class="text-sm font-bold block">{{ day.strftime('%a') }}</span>
                <span class="text-xs">{{ display_date }}</span>
            </a>
            {% endfor %}
        </div>
        <a href="{{ url_for('log.log_entry', selected_date=next_week_start.strftime('%Y-%m-%d')) }}" class="p-2 rounded-full hover:bg-gray-700">&gt;</a>
    </div>

    <div x-data="{ tab: '{{ request.args.get('tab', 'food') }}' }">
        <!-- Tabs -->
        <div class="flex flex-wrap gap-2 mb-6 justify-center">
            {% for t in ['food','water','weight','steps','sleep','calories_burnt'] %}
            <button @click="tab = '{{ t }}'" :class="{ 'bg-teal': tab === '{{ t }}', 'bg-gray-700': tab !== '{{ t }}' }" class="py-2 px-4 rounded-lg text-white font-semibold capitalize">
                {{ t.replace('_', ' ') }}
            </button>
            {% endfor %}
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Include all log forms -->
            <div>
                {% include 'partials/_log_forms.html' %}
            </div>

            <!-- Logged Entries -->
            <div>
                {% for type, type_entries in entries.items() %}
                <div x-show="tab === '{{ type }}'" style="{{ 'display: none;' if type != 'food' }}">
                    <div class="bg-dark p-4 rounded-xl shadow-lg">
                        <h3 class="text-lg font-bold mb-2 capitalize">Logged {{ type.replace('_', ' ') }}</h3>
                        <ul class="space-y-2">
                            {% for entry in type_entries %}
                            <li class="flex justify-between items-center text-sm p-2 rounded-lg bg-gray-800">
                                {% if type == 'food' %}
                                    <span>{{ entry.name }} ({{ entry.time.strftime('%H:%M') }}) - {{ entry.calories|int }} kcal</span>
                                {% elif type == 'water' %}
                                    <span>{{ entry.amount_ml }} ml</span>
                                {% elif type == 'weight' %}
                                    <span>{{ "%.1f"|format(entry.weight_kg) }} kg</span>
                                {% elif type == 'steps' %}
                                    <span>{{ entry.steps }} steps</span>
                                {% elif type == 'sleep' %}
                                    <span>{{ "%.1f"|format(entry.duration_hours) }} hours</span>
                                {% elif type == 'calories_burnt' %}
                                    <span>{{ entry.calories_burnt }} kcal</span>
                                {% endif %}
                                <div class="flex items-center space-x-2">
                                    <a href="{{ url_for('log.edit_entry', entry_type=type, entry_id=entry.id) }}" class="text-blue-400 hover:underline">Edit</a>
                                    <form action="{{ url_for('log.delete_entry', entry_type=type, entry_id=entry.id) }}" method="POST" class="inline">
                                        <button type="submit" class="text-red-500 hover:underline">Delete</button>
                                    </form>
                                </div>
                            </li>
                            {% else %}
                            <li class="text-gray-500">No {{ type.replace('_', ' ') }} logged yet.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
