{% extends "base.html" %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Inter Tight', sans-serif;
    background-color: #121212;
    color: #fff;
  }

  .card {
    background-color: #1E1E1E;
    border-radius: 1.25rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  }

  .accent-green { color: #C7FF41; }
  .accent-blue { color: #5BEAFF; }
  .accent-purple { color: #A970FF; }

  .btn {
    background-color: #2A2A2A;
    color: #fff;
    font-weight: 600;
    padding: 0.5rem 1rem;
    border-radius: 0.75rem;
    transition: background 0.2s;
  }
  .btn:hover { background-color: #333; }

  .tab-btn {
    padding: 0.5rem 1.25rem;
    border-radius: 0.75rem;
    font-weight: 600;
    text-transform: capitalize;
    transition: all 0.2s ease;
  }
  .tab-btn-active {
    background-color: #C7FF41;
    color: #000;
  }
  .tab-btn-inactive {
    background-color: #2A2A2A;
    color: #ccc;
  }
  .tab-btn-inactive:hover {
    background-color: #333;
  }

  .log-item {
    background-color: #2A2A2A;
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .log-item span { color: #ddd; }

  .log-item a {
    color: accent-green;
    font-weight: 500;
  }
  .log-item a:hover { text-decoration: underline; }

  .delete-btn { color: #FF375F; }

  .no-entry {
    color: #666;
    text-align: center;
    padding: 0.5rem 0;
  }

  .week-nav {
    background-color: #1E1E1E;
    border-radius: 1rem;
    padding: 0.5rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.4);
  }
  .week-btn {
    padding: 0.5rem;
    border-radius: 50%;
    transition: background 0.2s;
  }
  .week-btn:hover { background-color: #292929; }

  .day-btn {
    flex: 1;
    text-align: center;
    border-radius: 1rem;
    padding: 0.4rem 0.8rem;
    transition: background 0.2s, color 0.2s;
  }
  .day-btn-active {
    background-color: #C7FF41;
    color: #000;
  }
  .day-btn-inactive {
    background-color: #2A2A2A;
    color: #ccc;
  }
  .day-btn-inactive:hover { background-color: #333; }
</style>

<div class="p-6 pb-24 mx-auto max-w-screen-xl">


    <!-- ---------- WEEK SELECTOR ---------- -->
  <div class="flex justify-between items-center mb-6 bg-[#1E1E1E] p-2 rounded-2xl shadow-md">
    <a href="{{ url_for('log.log_entry', selected_date=prev_week_start.strftime('%Y-%m-%d')) }}" class="p-2 rounded-full hover:bg-[#292929]">&lt;</a>

    <div class="flex-1 flex justify-between items-center overflow-x-auto mx-2 md:mx-0 md:justify-center">
      {% for day in weekly_dates %}
      {% set is_today = day == date.today() %}
      {% set display_day = 'Today' if is_today else day.strftime('%-d') %}
      <a href="{{ url_for('log.log_entry', selected_date=day.strftime('%Y-%m-%d')) }}"
         class="flex-1 text-center py-2 mx-1 rounded-full font-semibold {{ 'bg-[#C7FF41] text-black' if day == selected_date else 'bg-[#2A2A2A] hover:bg-[#333] text-gray-300' }}">
          <span class="text-sm block">{{ day.strftime('%a') }}</span>
          <span class="text-xs">{{ display_day }}</span>
      </a>
      {% endfor %}
    </div>

    <a href="{{ url_for('log.log_entry', selected_date=next_week_start.strftime('%Y-%m-%d')) }}" class="p-2 rounded-full hover:bg-[#292929]">&gt;</a>
  </div>

  <div x-data="{ tab: '{{ request.args.get('tab', 'food') }}' }">

    <!-- TABS -->
    <div class="flex flex-wrap gap-2 mb-6 justify-center">
      {% for t in ['food','water','weight','steps','sleep','calories_burnt'] %}
      <button @click="tab = '{{ t }}'"
              :class="{ 'tab-btn-active': tab === '{{ t }}', 'tab-btn-inactive': tab !== '{{ t }}' }"
              class="tab-btn">
        {{ t.replace('_', ' ') }}
      </button>
      {% endfor %}
    </div>

    <!-- CONTENT GRID -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- LOG FORMS -->
      <div class="card p-5">
        {% include 'partials/_log_forms.html' %}
      </div>

      <!-- LOGGED ENTRIES -->
      <div>
        {% for type, type_entries in entries.items() %}
        <div x-show="tab === '{{ type }}'" style="{{ 'display: none;' if type != 'food' }}">
          <div class="card p-5">
            <h3 class="text-lg font-bold mb-3 capitalize">Logged {{ type.replace('_', ' ') }}</h3>
            <ul class="space-y-2">
              {% for entry in type_entries %}
              <li class="log-item">
                {% if type == 'food' %}
                  <span>{{ entry.name }} ({{ entry.time.strftime('%H:%M') }}) - {{ entry.calories|int }} kcal</span>
                {% elif type == 'water' %}
                  <span>{{ entry.amount_ml }} ml</span>
                {% elif type == 'weight' %}
                  <span>{{ "%.1f"|format(entry.weight_kg) }} kg</span>
                {% elif type == 'steps' %}
                  <span>{{ entry.steps }} steps</span>
                {% elif type == 'sleep' %}
                  <span>{{ "%.1f"|format(entry.duration_hours) }} hrs</span>
                {% elif type == 'calories_burnt' %}
                  <span>{{ entry.calories_burnt }} kcal</span>
                {% endif %}
                <div class="flex items-center space-x-2">
                  <a href="{{ url_for('log.edit_entry', entry_type=type, entry_id=entry.id) }}">Edit</a>
                  <form action="{{ url_for('log.delete_entry', entry_type=type, entry_id=entry.id) }}" method="POST" class="inline">
                    <button type="submit" class="delete-btn">Delete</button>
                  </form>
                </div>
              </li>
              {% else %}
              <li class="no-entry">No {{ type.replace('_', ' ') }} logged yet.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
        {% endfor %}
      </div>

    </div>
  </div>
</div>
{% endblock %}
